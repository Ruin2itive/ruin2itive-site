<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="light" />

  <title>ruin2itive.org</title>
  <meta name="description" content="Independent, self-hosted hub — signals, systems, memory." />

  <style>
    :root{
      --paper:#ffffff;
      --ink:#111;
      --muted:#5a5852;
      --rule:#ded6cc;
      --rule2:#eee7df;

      --red:#8b1f1f;

      --radius:14px;

      --max: 1180px;
      --g: 18px;

      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bot: env(safe-area-inset-bottom, 0px);

      --shadow: 0 10px 26px rgba(0,0,0,.10);
      --shadowSoft: 0 6px 16px rgba(0,0,0,.08);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--ink);
      background: var(--paper);
      font-family: ui-serif, Georgia, "Times New Roman", Times, serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    a{ color:inherit; text-decoration:none; }
    a:hover{ text-decoration:underline; }

    /* subtle paper grain without images */
    body::before{
      content:"";
      position:fixed;
      inset:0;
      pointer-events:none;
      background:
        radial-gradient(900px 500px at 20% 10%, rgba(0,0,0,.03), transparent 60%),
        radial-gradient(900px 500px at 80% 0%, rgba(0,0,0,.02), transparent 60%),
        linear-gradient(to bottom, rgba(0,0,0,.015), transparent 18%, rgba(0,0,0,.02));
      opacity:.55;
      z-index:0;
    }

    .wrap{
      position:relative;
      z-index:1;
      max-width: var(--max);
      margin:0 auto;
      padding: 0 18px calc(26px + var(--safe-bot));
    }

    /* ======================
       MASTHEAD (NEWSPAPER)
       ====================== */
    header{
      position:relative;
      padding-top: calc(12px + var(--safe-top));
      padding-bottom: 10px;
      border-bottom: 1px solid var(--rule);
      background: var(--paper);
      overflow:hidden;
    }

    /* elephant lives ONLY inside masthead, controlled */
    header::before{
      content:"";
      position:absolute;
      inset:-40px -40px -60px -40px;
      background-image:
        url("assets/elephant-third-eye.webp"),
        url("assets/elephant-third-eye.png"),
        url("assets/elephant-bg.PNG");
      background-repeat:no-repeat;
      background-size: cover;
      background-position: center 36%;
      opacity: .18;              /* key: controlled */
      filter: grayscale(1) contrast(1.25);
      pointer-events:none;
      z-index:0;
    }

    /* veil to keep masthead clean and readable */
    header::after{
      content:"";
      position:absolute;
      inset:0;
      background:
        linear-gradient(to bottom,
          rgba(255,255,255,.88) 0%,
          rgba(255,255,255,.86) 45%,
          rgba(255,255,255,1) 100%);
      pointer-events:none;
      z-index:0;
    }

    .mast{
      position:relative;
      z-index:1;
      text-align:center;
      padding: 6px 0 6px;
    }

    .kickerline{
      font-size: 10px;
      letter-spacing: .34em;
      text-transform: uppercase;
      color: rgba(0,0,0,.62);
      margin: 0 0 10px;
      white-space: nowrap;
      overflow:hidden;
      text-overflow: ellipsis;
    }

    .title{
      margin:0;
      font-size: clamp(34px, 4.6vw, 62px);
      line-height: 1.02;
      letter-spacing: -0.02em;
      color: rgba(0,0,0,.92);
    }

    .tagline{
      margin: 10px 0 0;
      font-size: 11px;
      letter-spacing: .22em;
      text-transform: uppercase;
      color: rgba(0,0,0,.58);
    }

    .rules{
      margin-top: 14px;
      position:relative;
    }
    .rules .thin{
      height:1px;
      background: var(--rule);
    }
    .rules .thick{
      height:3px;
      background: rgba(139,31,31,.28);
      width: 110px;
      margin: 10px auto 0;
      border-radius: 999px;
    }

    /* Nav strip (feels like a section index) */
    .navstrip{
      display:flex;
      justify-content:center;
      gap: 14px;
      flex-wrap:wrap;
      padding: 12px 0 2px;
      margin: 0;
      list-style:none;
      position:relative;
      z-index:1;
    }
    .navstrip a{
      font-size: 10px;
      letter-spacing: .22em;
      text-transform: uppercase;
      color: rgba(0,0,0,.70);
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,.14);
      background: rgba(255,255,255,.75);
    }
    .navstrip a:hover{
      text-decoration:none;
      border-color: rgba(139,31,31,.35);
    }

    /* ======================
       FRONT PAGE GRID
       ====================== */
    main{
      padding-top: 18px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: var(--g);
      align-items:start;
    }
    @media (min-width: 980px){
      .grid{ grid-template-columns: 1.02fr .98fr; }
    }

    /* ======================
       SECTION CARDS (PAPER)
       ====================== */
    .card{
      background: rgba(255,255,255,.96);
      border: 1px solid rgba(0,0,0,.12);
      border-radius: var(--radius);
      box-shadow: var(--shadowSoft);
      overflow:hidden;
    }

    .head{
      padding: 14px 16px 10px;
      border-bottom: 1px solid var(--rule2);
      display:flex;
      justify-content:space-between;
      gap: 10px;
      align-items:flex-end;
      background: rgba(255,255,255,.98);
    }

    .kicker{
      font-size: 11px;
      letter-spacing: .34em;
      text-transform: uppercase;
      color: var(--red);
      font-weight: 800;
      line-height: 1.1;
    }

    .mini{
      font-size: 10px;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: rgba(0,0,0,.52);
      white-space:nowrap;
    }

    .body{
      padding: 12px 16px 14px;
    }

    /* Projects list */
    .proj{
      padding: 10px 0;
      border-bottom: 1px solid rgba(0,0,0,.10);
    }
    .proj:last-child{ border-bottom:none; padding-bottom:6px; }

    .proj .name{
      font-size: clamp(26px, 2.4vw, 38px);
      line-height: 1;
      margin: 0 0 10px;
      letter-spacing: -0.02em;
    }

    .pills{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      border: 1px solid rgba(0,0,0,.20);
      color: rgba(0,0,0,.78);
      padding: 6px 11px;
      border-radius: 999px;
      font-size: 10px;
      letter-spacing: .20em;
      text-transform: uppercase;
      background: rgba(255,255,255,.92);
      white-space:nowrap;
    }

    /* Feed items */
    .item{
      display:block;
      padding: 12px 0;
      border-bottom: 1px solid rgba(0,0,0,.10);
    }
    .item:last-child{ border-bottom:none; padding-bottom:6px; }

    .item h3{
      margin:0 0 8px;
      font-size: 16px;
      line-height: 1.18;
      letter-spacing: .01em;
    }

    .meta{
      display:flex;
      gap: 8px;
      align-items:center;
      flex-wrap:wrap;
      color: var(--muted);
      font-size: 11px;
    }

    .stamp{
      display:inline-flex;
      align-items:center;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,.18);
      background: rgba(255,255,255,.96);
      font-size: 9px;
      letter-spacing: .16em;
      text-transform: uppercase;
      color: rgba(0,0,0,.62);
    }
    .stamp.red{
      border-color: rgba(139,31,31,.40);
      color: rgba(139,31,31,.88);
    }

    /* Loading skeleton */
    .feature{ padding: 12px 0 8px; }
    .headline{ font-size: 16px; margin:0 0 6px; }
    .sub{
      color: var(--muted);
      margin:0 0 10px;
      font-size: 12px;
      line-height: 1.35;
    }
    .status{
      color: rgba(0,0,0,.56);
      font-size: 10px;
      letter-spacing: .16em;
      text-transform: uppercase;
    }

    .skel{
      border-radius: 10px;
      height: 12px;
      background: linear-gradient(
        90deg,
        rgba(0,0,0,.06),
        rgba(0,0,0,.12),
        rgba(0,0,0,.06)
      );
      background-size: 220% 100%;
      animation: shimmer 1.2s infinite linear;
    }
    .skel.t{ height: 18px; border-radius: 12px; }
    .skel.s{ height: 12px; width: 78%; }
    .skel.m{ height: 12px; width: 54%; }

    @keyframes shimmer{
      0%{ background-position: 0% 0; }
      100%{ background-position: 220% 0; }
    }

    footer{
      margin-top: 18px;
      border-top: 1px solid var(--rule);
      padding: 16px 0 calc(18px + var(--safe-bot));
      color: rgba(0,0,0,.56);
      font-size: 11px;
      letter-spacing: .10em;
      text-transform: uppercase;
      text-align:center;
    }

    /* iPhone tuning */
    @media (max-width: 520px){
      :root{ --g: 14px; }
      .kickerline{ letter-spacing:.26em; }
      .title{ font-size: 40px; }
      .tagline{ letter-spacing:.18em; }
      .head{ padding: 12px 14px 9px; }
      .body{ padding: 10px 14px 12px; }
      header::before{
        background-position: center 34%;
        opacity: .16;
      }
    }
  </style>
</head>

<body>
  <header>
    <div class="wrap">
      <div class="mast">
        <div class="kickerline">Reliability • Open Source • Independent</div>
        <h1 class="title">ruin2itive</h1>
        <div class="tagline">Signals • Systems • Memory</div>

        <div class="rules" aria-hidden="true">
          <div class="thin"></div>
          <div class="thick"></div>
        </div>

        <ul class="navstrip" aria-label="Section index">
          <li><a href="#projects">Projects</a></li>
          <li><a href="#markets">Markets</a></li>
          <li><a href="#hacker">Hacker</a></li>
        </ul>
      </div>
    </div>
  </header>

  <div class="wrap">
    <main>
      <section class="grid">
        <!-- LEFT -->
        <article class="card" id="projects" aria-label="Projects / The Code">
          <div class="head">
            <div class="kicker">Projects / The Code</div>
            <div class="mini" id="projects-updated">Standby</div>
          </div>
          <div class="body" id="projects-root">
            <div class="feature">
              <div class="headline"><div class="skel t"></div></div>
              <div class="sub">
                <div class="skel s" style="margin:10px 0 8px;"></div>
                <div class="skel m"></div>
              </div>
              <div class="status">Status: loading</div>
            </div>
          </div>
        </article>

        <!-- RIGHT -->
        <article class="card" id="markets" aria-label="Markets / Crypto">
          <div class="head">
            <div class="kicker">Markets / Crypto</div>
            <div class="mini" id="decrypt-updated">Standby</div>
          </div>
          <div class="body" id="decrypt-root">
            <div class="feature">
              <div class="headline"><div class="skel t"></div></div>
              <div class="sub">
                <div class="skel s" style="margin:10px 0 8px;"></div>
                <div class="skel m"></div>
              </div>
              <div class="status">Status: loading</div>
            </div>
          </div>

          <div class="head" style="border-top:1px solid var(--rule2);">
            <div class="kicker" id="hacker">Hacker News</div>
            <div class="mini" id="hn-updated">Standby</div>
          </div>
          <div class="body" id="hn-root">
            <div class="feature">
              <div class="headline">Quiet</div>
              <div class="sub">This section fills from <span class="stamp">home.json</span> when available.</div>
              <div class="status">Status: standby</div>
            </div>
          </div>
        </article>
      </section>
    </main>

    <footer>
      ruin2itive.org — signals • systems • memory
    </footer>
  </div>

  <script>
    function esc(s){
      return String(s ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function nowBust(){ return String(Date.now()); }

    function stamp(text, variant){
      const cls = variant === "source" ? "stamp red" : "stamp";
      return `<span class="${cls}">${esc(text)}</span>`;
    }

    async function fetchJson(url){
      const r = await fetch(url, { cache: "no-store" });
      if (!r.ok) throw new Error(`HTTP ${r.status}`);
      return await r.json();
    }

    function setMini(id, text){
      const el = document.getElementById(id);
      if (!el) return;
      el.textContent = text || "Standby";
    }

    function renderError(root, title, detail){
      root.innerHTML = `
        <div class="feature">
          <div class="headline">${esc(title)}</div>
          <div class="sub">${esc(detail)}</div>
          <div class="status">Status: error</div>
        </div>
      `;
    }

    function renderProjects(data){
      const root = document.getElementById("projects-root");
      const groups = data?.groups;

      const u = data?.updated_iso ? new Date(data.updated_iso) : null;
      const uText = (u && !isNaN(u.getTime())) ? `Updated: ${u.toLocaleString()}` : "Live";
      setMini("projects-updated", uText);

      if (!Array.isArray(groups) || groups.length === 0){
        root.innerHTML = `
          <div class="feature">
            <div class="headline">No projects</div>
            <div class="sub">Your projects.json has no groups.</div>
            <div class="status">Status: empty</div>
          </div>
        `;
        return;
      }

      root.innerHTML = groups.map(g => {
        const name = g?.title || g?.name || "project";
        const links = Array.isArray(g?.links) ? g.links : [];

        const pills = links.map(l => {
          const label = l?.label || "link";
          const url = l?.href || l?.url || "#";
          return `<a class="pill" href="${esc(url)}" target="_blank" rel="noopener">${esc(label)}</a>`;
        }).join("");

        return `
          <div class="proj">
            <div class="name">${esc(name)}</div>
            <div class="pills">${pills}</div>
          </div>
        `;
      }).join("");
    }

    function renderDecrypt(data){
      const root = document.getElementById("decrypt-root");
      const items = Array.isArray(data?.items) ? data.items : [];
      const updated = data?.updated ? new Date(data.updated) : null;

      const isSeed =
        (items[0]?.stamp === "SEED") ||
        (typeof data?.updated === "string" && data.updated.startsWith("1970-")) ||
        (!updated || isNaN(updated.getTime())) ||
        (updated && updated.getFullYear && updated.getFullYear() < 2000);

      const updatedText = (!isSeed && updated && !isNaN(updated.getTime()))
        ? `Updated: ${updated.toLocaleString()}`
        : "Seed (waiting on feed)";

      setMini("decrypt-updated", updatedText);

      const itemsHtml = items.slice(0, 5).map(it => {
        const title = it?.title || "Untitled";
        const url = it?.url || "#";
        const src = it?.source || "decrypt";
        const st = it?.stamp || "";

        return `
          <a class="item" href="${esc(url)}" target="_blank" rel="noopener">
            <h3>${esc(title)}</h3>
            <div class="meta">
              ${st ? stamp(st) : ""}
              ${stamp(src, "source")}
            </div>
          </a>
        `;
      }).join("");

      root.innerHTML = itemsHtml || `
        <div class="feature">
          <div class="headline">No items</div>
          <div class="sub">Your feed is empty.</div>
          <div class="status">Status: empty</div>
        </div>
      `;
    }

    function renderHNfromHomeJson(home){
      const root = document.getElementById("hn-root");
      const items = home?.sections?.hacker;

      const updated = home?.updated_iso ? new Date(home.updated_iso) : null;
      const updatedText = (updated && !isNaN(updated.getTime()))
        ? `Updated: ${updated.toLocaleString()}`
        : "Standby";

      setMini("hn-updated", updatedText);

      if (!Array.isArray(items) || items.length === 0) return;

      root.innerHTML = items.slice(0, 10).map(it => {
        const title = it?.title || "Untitled";
        const url = it?.url || "#";
        return `
          <a class="item" href="${esc(url)}" target="_blank" rel="noopener">
            <h3>${esc(title)}</h3>
            <div class="meta">${stamp("hn", "source")}${stamp("newest")}</div>
          </a>
        `;
      }).join("");
    }

    async function boot(){
      try{
        const projects = await fetchJson(`data/projects.json?${nowBust()}`);
        renderProjects(projects);
      }catch(e){
        setMini("projects-updated", "Error");
        renderError(
          document.getElementById("projects-root"),
          "Projects",
          `Could not load data/projects.json (${e.message}).`
        );
      }

      try{
        const decrypt = await fetchJson(`data/decrypt.json?${nowBust()}`);
        renderDecrypt(decrypt);
      }catch(e){
        setMini("decrypt-updated", "Error");
        renderError(
          document.getElementById("decrypt-root"),
          "Decrypt",
          `Could not load data/decrypt.json (${e.message}).`
        );
      }

      try{
        const home = await fetchJson(`data/home.json?${nowBust()}`);
        renderHNfromHomeJson(home);
      }catch(_e){
        // silent
      }
    }

    boot();
  </script>
</body>
</html>
