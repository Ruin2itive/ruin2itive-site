<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="light" />

  <title>ruin2itive.org</title>
  <meta name="description" content="Independent, self-hosted hub — signals, systems, memory." />

  <style>
    :root{
      --paper:#f4f1ea;
      --ink:#111;
      --muted:#5a5852;
      --rule:#d9d1c6;
      --card:#f6f2ea;
      --shadow2: 0 10px 30px rgba(0,0,0,.08);
      --red:#8b1f1f;

      --radius:18px;
      --max: 1240px;
      --g: 22px;

      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bot: env(safe-area-inset-bottom, 0px);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-serif, Georgia, "Times New Roman", Times, serif;
      color:var(--ink);
      background: var(--paper);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    a{ color:inherit; text-decoration:none; }
    a:hover{ text-decoration:underline; }

    /* ---------- HERO ---------- */
    .hero{
      position:relative;
      overflow:hidden;
      background: var(--paper);
      min-height: clamp(360px, 56vh, 640px);
      padding-top: calc(10px + var(--safe-top));
    }

    /* Hero image layer (we set background-image via JS once we find a real path) */
    .hero-media{
      position:absolute;
      inset:-60px;
      z-index:0;
      pointer-events:none;

      background-position: center 55%;
      background-size: cover;
      background-repeat: no-repeat;

      /* If image is missing, this stays paper-colored */
      background-color: var(--paper);
      transform: translateZ(0);
      opacity: 1;
      filter: saturate(1) contrast(1);
    }

    /* Fade so background image stays visible */
    .hero::after{
      content:"";
      position:absolute;
      inset:0;
      z-index:1;
      background:
        linear-gradient(to bottom,
          rgba(244,241,234,0) 0%,
          rgba(244,241,234,0) 50%,
          rgba(244,241,234,.60) 70%,
          rgba(244,241,234,1) 100%);
      pointer-events:none;
    }

    /* Wordmark overlay */
    .mast{
      position:relative;
      z-index:2;
      max-width: var(--max);
      margin: 0 auto;
      padding: 14px 18px 0;
      display:flex;
      justify-content:center;
      text-align:center;
      pointer-events:none;
      mix-blend-mode:multiply;
    }
    .mast .kickerline{
      font-size: 11px;
      letter-spacing: .30em;
      text-transform: uppercase;
      color: rgba(0,0,0,.52);
      margin-bottom: 8px;
    }
    .mast .title{
      font-size: clamp(30px, 4.2vw, 46px);
      letter-spacing: -0.01em;
      margin: 0;
      color: rgba(0,0,0,.78);
    }
    .mast .tagline{
      margin-top: 8px;
      font-size: 12px;
      letter-spacing: .22em;
      text-transform: uppercase;
      color: rgba(0,0,0,.52);
    }

    /* ---------- LAYOUT ---------- */
    .wrap{
      position:relative;
      max-width: var(--max);
      margin: 0 auto;
      padding: 0 18px calc(60px + var(--safe-bot));
    }

    main{
      position:relative;
      margin-top: clamp(-170px, -12vh, -110px);
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: var(--g);
      align-items:start;
    }

    @media (min-width: 920px){
      .grid{ grid-template-columns: 1.05fr 1.0fr; }
    }

    @media (min-width: 1240px){
      .grid{ grid-template-columns: 1.05fr 1.0fr; gap: 26px; }
    }

    /* ---------- CARDS ---------- */
    .card{
      background: var(--card);
      border: 1px solid rgba(0,0,0,.06);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      overflow:hidden;
    }

    .head{
      padding: 16px 18px 12px;
      background: rgba(255,255,255,.24);
      border-bottom: 1px solid var(--rule);
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap: 10px;
    }

    .kicker{
      font-size: 12px;
      letter-spacing: .30em;
      text-transform: uppercase;
      color: var(--red);
      font-weight: 700;
      line-height: 1.1;
    }

    .head .mini{
      font-size: 11px;
      letter-spacing: .16em;
      text-transform: uppercase;
      color: rgba(0,0,0,.48);
      white-space:nowrap;
    }

    .body{ padding: 14px 18px 16px; }

    /* ---------- PROJECTS ---------- */
    .proj{
      padding: 12px 0;
      border-bottom: 1px solid rgba(0,0,0,.06);
    }
    .proj:last-child{ border-bottom:none; padding-bottom:6px; }

    .proj .name{
      font-size: clamp(32px, 3.2vw, 44px);
      line-height: 1;
      margin: 0 0 10px;
      letter-spacing: -0.02em;
    }

    .pills{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      padding-bottom: 2px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      border: 1px solid rgba(0,0,0,.22);
      color: rgba(0,0,0,.78);
      padding: 7px 14px;
      border-radius: 999px;
      font-size: 11px;
      letter-spacing: .20em;
      text-transform: uppercase;
      background: rgba(255,255,255,.34);
      white-space:nowrap;
    }

    /* ---------- FEED ITEMS ---------- */
    .item{
      display:block;
      padding: 12px 0;
      border-bottom: 1px solid rgba(0,0,0,.06);
    }
    .item:last-child{ border-bottom:none; padding-bottom:6px; }

    .item h3{
      margin:0 0 7px;
      font-size: 17px;
      line-height: 1.18;
      letter-spacing: .01em;
    }

    .meta{
      display:flex;
      gap: 8px;
      align-items:center;
      flex-wrap:wrap;
      color: var(--muted);
      font-size: 12px;
    }

    /* ---------- STAMPS ---------- */
    .stamp{
      display:inline-flex;
      align-items:center;
      padding: 3px 10px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,.16);
      background: rgba(255,255,255,.34);
      font-size: 10px;
      letter-spacing: .16em;
      text-transform: uppercase;
      color: rgba(0,0,0,.62);
    }
    .stamp.red{
      border-color: rgba(139,31,31,.35);
      color: rgba(139,31,31,.85);
    }

    /* ---------- “QUIET / EMPTY / ERROR” ---------- */
    .feature{ padding: 14px 0 8px; }
    .headline{ font-size: 17px; margin:0 0 6px; }
    .sub{
      color: var(--muted);
      margin:0 0 10px;
      font-size: 13px;
      line-height: 1.35;
    }
    .status{
      color: rgba(0,0,0,.55);
      font-size: 11px;
      letter-spacing: .14em;
      text-transform: uppercase;
    }

    /* ---------- SKELETON LOADING ---------- */
    .skel{
      border-radius: 10px;
      height: 12px;
      background: linear-gradient(
        90deg,
        rgba(0,0,0,.06),
        rgba(0,0,0,.11),
        rgba(0,0,0,.06)
      );
      background-size: 220% 100%;
      animation: shimmer 1.2s infinite linear;
    }
    .skel.t{ height: 18px; border-radius: 12px; }
    .skel.s{ height: 12px; width: 78%; }
    .skel.m{ height: 12px; width: 54%; }

    @keyframes shimmer{
      0%{ background-position: 0% 0; }
      100%{ background-position: 220% 0; }
    }

    /* ---------- FOOTER ---------- */
    footer{
      max-width: var(--max);
      margin: 0 auto;
      padding: 24px 18px calc(38px + var(--safe-bot));
      color: rgba(0,0,0,.55);
      font-size: 12px;
      letter-spacing: .08em;
      text-transform: uppercase;
      text-align:center;
    }
  </style>
</head>

<body>
  <header class="hero" aria-label="ruin2itive hero background">
    <div class="hero-media" id="hero-media" aria-hidden="true"></div>

    <!-- No-JS fallback (still tries relative paths) -->
    <noscript>
      <style>
        #hero-media{
          background-image: url("assets/landing.webp"), url("assets/landing.png");
        }
      </style>
    </noscript>

    <div class="mast" aria-hidden="true">
      <div>
        <div class="kickerline">Reliability • Open Source • Independent</div>
        <h1 class="title">ruin2itive</h1>
        <div class="tagline">Signals • Systems • Memory</div>
      </div>
    </div>
  </header>

  <div class="wrap">
    <main>
      <section class="grid">
        <!-- LEFT -->
        <article class="card" aria-label="Projects / The Code">
          <div class="head">
            <div class="kicker">Projects / The Code</div>
            <div class="mini" id="projects-updated">Standby</div>
          </div>
          <div class="body" id="projects-root">
            <div class="feature">
              <div class="headline"><div class="skel t"></div></div>
              <div class="sub">
                <div class="skel s" style="margin:10px 0 8px;"></div>
                <div class="skel m"></div>
              </div>
              <div class="status">Status: loading</div>
            </div>
          </div>
        </article>

        <!-- RIGHT -->
        <article class="card" aria-label="Markets / Crypto">
          <div class="head">
            <div class="kicker">Markets / Crypto</div>
            <div class="mini" id="decrypt-updated">Standby</div>
          </div>
          <div class="body" id="decrypt-root">
            <div class="feature">
              <div class="headline"><div class="skel t"></div></div>
              <div class="sub">
                <div class="skel s" style="margin:10px 0 8px;"></div>
                <div class="skel m"></div>
              </div>
              <div class="status">Status: loading</div>
            </div>
          </div>

          <div class="head" style="border-top:1px solid var(--rule);">
            <div class="kicker">Hacker News</div>
            <div class="mini" id="hn-updated">Standby</div>
          </div>
          <div class="body" id="hn-root">
            <div class="feature">
              <div class="headline">Quiet</div>
              <div class="sub">This section fills from <span class="stamp">home.json</span> when available.</div>
              <div class="status">Status: standby</div>
            </div>
          </div>
        </article>
      </section>
    </main>
  </div>

  <footer>
    ruin2itive.org — signals • systems • memory
  </footer>

  <script>
    // -----------------------------
    // HERO IMAGE: auto-resolve correct path
    // -----------------------------
    (function bootHero(){
      const el = document.getElementById("hero-media");
      if (!el) return;

      const repoGuess = location.pathname.split("/").filter(Boolean)[0] || "";

      // Try in this order: absolute root, relative, repo-subpath (GitHub Pages), and a couple common variants.
      const candidates = [
        "/assets/landing.webp",
        "/assets/landing.png",
        "assets/landing.webp",
        "assets/landing.png",
        repoGuess ? ("/" + repoGuess + "/assets/landing.webp") : "",
        repoGuess ? ("/" + repoGuess + "/assets/landing.png") : "",
        "/ruin2itive-site/assets/landing.webp",
        "/ruin2itive-site/assets/landing.png"
      ].filter(Boolean);

      function tryLoad(url){
        return new Promise((resolve) => {
          const img = new Image();
          img.onload = () => resolve({ ok:true, url });
          img.onerror = () => resolve({ ok:false, url });
          img.decoding = "async";
          img.src = url + (url.includes("?") ? "&" : "?") + "v=" + Date.now();
        });
      }

      (async () => {
        for (const url of candidates){
          const r = await tryLoad(url);
          if (r.ok){
            el.style.backgroundImage = `url("${r.url}")`;
            console.log("[ruin2itive] Hero image OK:", r.url);
            return;
          }
        }

        console.error(
          "[ruin2itive] HERO IMAGE FAILED. None of these paths loaded:\n" +
          candidates.map(x => " - " + x).join("\n") +
          "\nFix: ensure landing.webp or landing.png exists in /assets/ and filename case matches exactly."
        );
      })();
    })();

    // -----------------------------
    // Utilities
    // -----------------------------
    function esc(s){
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function nowBust(){ return String(Date.now()); }

    function stamp(text, variant){
      const cls = variant === "source" ? "stamp red" : "stamp";
      return `<span class="${cls}">${esc(text)}</span>`;
    }

    async function fetchJson(url){
      const r = await fetch(url, { cache: "no-store" });
      if (!r.ok) throw new Error(`HTTP ${r.status}`);
      return await r.json();
    }

    function setMini(id, text){
      const el = document.getElementById(id);
      if (!el) return;
      el.textContent = text || "Standby";
    }

    function renderError(root, title, detail){
      root.innerHTML = `
        <div class="feature">
          <div class="headline">${esc(title)}</div>
          <div class="sub">${esc(detail)}</div>
          <div class="status">Status: error</div>
        </div>
      `;
    }

    // -----------------------------
    // Renderers
    // -----------------------------
    function renderProjects(data){
      const root = document.getElementById("projects-root");
      const groups = data?.groups;

      const u = data?.updated_iso ? new Date(data.updated_iso) : null;
      const uText = (u && !isNaN(u.getTime())) ? `Updated: ${u.toLocaleString()}` : "Live";
      setMini("projects-updated", uText);

      if (!Array.isArray(groups) || groups.length === 0){
        root.innerHTML = `
          <div class="feature">
            <div class="headline">No projects</div>
            <div class="sub">Your projects.json has no groups.</div>
            <div class="status">Status: empty</div>
          </div>
        `;
        return;
      }

      const html = groups.map(g => {
        const name = g?.title || g?.name || "project";
        const links = Array.isArray(g?.links) ? g.links : [];

        const pills = links.map(l => {
          const label = l?.label || "link";
          const url = l?.href || l?.url || "#";
          return `<a class="pill" href="${esc(url)}" target="_blank" rel="noopener">${esc(label)}</a>`;
        }).join("");

        return `
          <div class="proj">
            <div class="name">${esc(name)}</div>
            <div class="pills">${pills}</div>
          </div>
        `;
      }).join("");

      root.innerHTML = html;
    }

    function renderDecrypt(data){
      const root = document.getElementById("decrypt-root");
      const items = Array.isArray(data?.items) ? data.items : [];
      const updated = data?.updated ? new Date(data.updated) : null;

      const isSeed =
        (items[0]?.stamp === "SEED") ||
        (typeof data?.updated === "string" && data.updated.startsWith("1970-")) ||
        (!updated || isNaN(updated.getTime())) ||
        (updated && updated.getFullYear && updated.getFullYear() < 2000);

      const updatedText = (!isSeed && updated && !isNaN(updated.getTime()))
        ? `Updated: ${updated.toLocaleString()}`
        : "Seed (waiting on feed)";

      setMini("decrypt-updated", updatedText);

      const itemsHtml = items.slice(0, 3).map(it => {
        const title = it?.title || "Untitled";
        const url = it?.url || "#";
        const src = it?.source || "decrypt";
        const st = it?.stamp || "";

        return `
          <a class="item" href="${esc(url)}" target="_blank" rel="noopener">
            <h3>${esc(title)}</h3>
            <div class="meta">
              ${st ? stamp(st) : ""}
              ${stamp(src, "source")}
            </div>
          </a>
        `;
      }).join("");

      root.innerHTML = `
        ${itemsHtml || `
          <div class="feature">
            <div class="headline">No items</div>
            <div class="sub">Your feed is empty.</div>
            <div class="status">Status: empty</div>
          </div>
        `}
      `;
    }

    function renderHNfromHomeJson(home){
      const root = document.getElementById("hn-root");
      const items = home?.sections?.hacker;

      const updated = home?.updated_iso ? new Date(home.updated_iso) : null;
      const updatedText = (updated && !isNaN(updated.getTime()))
        ? `Updated: ${updated.toLocaleString()}`
        : "Standby";

      setMini("hn-updated", updatedText);

      if (!Array.isArray(items) || items.length === 0) return;

      const html = items.slice(0, 5).map(it => {
        const title = it?.title || "Untitled";
        const url = it?.url || "#";
        return `
          <a class="item" href="${esc(url)}" target="_blank" rel="noopener">
            <h3>${esc(title)}</h3>
            <div class="meta">${stamp("hn", "source")}${stamp("newest")}</div>
          </a>
        `;
      }).join("");

      root.innerHTML = html;
    }

    // -----------------------------
    // Boot (relative JSON paths)
    // -----------------------------
    async function boot(){
      try{
        const projects = await fetchJson(`data/projects.json?${nowBust()}`);
        renderProjects(projects);
      }catch(e){
        setMini("projects-updated", "Error");
        renderError(
          document.getElementById("projects-root"),
          "Projects",
          `Could not load data/projects.json (${e.message}).`
        );
      }

      try{
        const decrypt = await fetchJson(`data/decrypt.json?${nowBust()}`);
        renderDecrypt(decrypt);
      }catch(e){
        setMini("decrypt-updated", "Error");
        renderError(
          document.getElementById("decrypt-root"),
          "Decrypt",
          `Could not load data/decrypt.json (${e.message}).`
        );
      }

      try{
        const home = await fetchJson(`data/home.json?${nowBust()}`);
        renderHNfromHomeJson(home);
      }catch(_e){
        // silent
      }
    }

    boot();
  </script>
</body>
</html>
