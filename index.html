<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="color-scheme" content="light" />

  <title>ruin2itive.org</title>
  <meta name="description" content="Independent, self-hosted hub — signals, systems, memory." />

  <style>
    :root{
      --paper:#f4f1ea;
      --paper2:#efeae2;
      --ink:#111;
      --muted:#5a5852;
      --rule:#d9d1c6;
      --card:#f6f2ea;
      --shadow: 0 18px 60px rgba(0,0,0,.10);
      --shadow2: 0 10px 30px rgba(0,0,0,.08);
      --red:#8b1f1f;
      --red2:#b23a3a;
      --radius:18px;
      --radius2:14px;
      --max: 1080px;
      --g: 22px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-serif, Georgia, "Times New Roman", Times, serif;
      color:var(--ink);
      background: var(--paper);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    a{ color:inherit; text-decoration:none; }
    a:hover{ text-decoration:underline; }

    /* --- Hero (background art) --- */
    .hero{
      position:relative;
      background: var(--paper);
      overflow:hidden;
      min-height: 58vh; /* mobile: looks like your iPhone */
    }
    .hero::before{
      content:"";
      position:absolute;
      inset:-40px -40px -40px -40px;
      background-image: url("assets/landing.webp");
      background-size: cover;
      background-repeat:no-repeat;
      background-position: center 45%;
      opacity: 1;
      filter: saturate(1) contrast(1);
      transform: translateZ(0);
    }
    .hero::after{
      /* subtle fade to paper so cards sit on clean background */
      content:"";
      position:absolute;
      inset:0;
      background:
        linear-gradient(to bottom,
          rgba(244,241,234,0) 0%,
          rgba(244,241,234,0) 55%,
          rgba(244,241,234,.75) 72%,
          rgba(244,241,234,1) 100%);
      pointer-events:none;
    }

    /* --- Layout container --- */
    .wrap{
      position:relative;
      max-width: var(--max);
      margin: 0 auto;
      padding: 0 18px 70px;
    }

    /* Pull grid upward into hero area */
    main{
      position:relative;
      margin-top: -120px;
      padding-top: 0;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: var(--g);
      align-items:start;
    }

    @media (min-width: 880px){
      .grid{
        grid-template-columns: 1fr 1fr;
      }
    }

    /* --- Cards --- */
    .card{
      background: var(--card);
      border: 1px solid rgba(0,0,0,.06);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      overflow:hidden;
    }

    .card .head{
      padding: 18px 18px 14px;
      background: rgba(255,255,255,.25);
      border-bottom: 1px solid var(--rule);
    }

    .kicker{
      font-size: 13px;
      letter-spacing: .28em;
      text-transform: uppercase;
      color: var(--red);
      font-weight: 700;
    }

    .body{
      padding: 14px 18px 18px;
    }

    .rule{
      height:1px;
      background: var(--rule);
      margin: 12px 0;
    }

    /* --- Items --- */
    .item{
      display:block;
      padding: 12px 0;
      border-bottom: 1px solid rgba(0,0,0,.06);
    }
    .item:last-child{ border-bottom:none; padding-bottom:4px; }

    .item h3{
      margin:0 0 6px;
      font-size: 18px;
      line-height: 1.15;
      letter-spacing: .01em;
    }
    .item .meta{
      display:flex;
      gap: 8px;
      align-items:center;
      flex-wrap:wrap;
      color: var(--muted);
      font-size: 12px;
    }

    /* --- Projects blocks --- */
    .proj{
      padding: 12px 0;
      border-bottom: 1px solid rgba(0,0,0,.06);
    }
    .proj:last-child{ border-bottom:none; }

    .proj .name{
      font-size: 40px;
      line-height: 1;
      margin: 0 0 8px;
      letter-spacing: -0.02em;
    }
    @media (max-width: 420px){
      .proj .name{ font-size: 36px; }
    }

    .pills{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      padding-bottom: 2px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      border: 1px solid rgba(0,0,0,.20);
      color: rgba(0,0,0,.78);
      padding: 7px 14px;
      border-radius: 999px;
      font-size: 12px;
      letter-spacing: .18em;
      text-transform: uppercase;
      background: rgba(255,255,255,.35);
      white-space:nowrap;
    }

    /* --- “stamp” labels --- */
    .stamp{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 3px 10px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,.15);
      background: rgba(255,255,255,.35);
      font-size: 11px;
      letter-spacing: .14em;
      text-transform: uppercase;
      color: rgba(0,0,0,.65);
    }
    .stamp.red{
      border-color: rgba(139,31,31,.35);
      color: rgba(139,31,31,.85);
    }

    /* --- Quiet “feature” card inside lists --- */
    .feature{
      padding: 14px 0 6px;
    }
    .headline{
      font-size: 18px;
      margin:0 0 5px;
    }
    .sub{
      color: var(--muted);
      margin:0 0 10px;
      font-size: 13px;
      line-height: 1.35;
    }
    .status{
      color: rgba(0,0,0,.55);
      font-size: 12px;
      letter-spacing: .12em;
      text-transform: uppercase;
    }

    /* --- Desktop hero framing fix (make Mac match iPhone) --- */
    @media (min-width: 880px){
      .hero{
        min-height: clamp(340px, 50vh, 560px);
      }
      .hero::before{
        background-position: center 58%;
      }
      main{
        margin-top: calc(-1 * clamp(90px, 12vh, 170px));
      }
    }

    /* --- Footer spacing --- */
    footer{
      max-width: var(--max);
      margin: 0 auto;
      padding: 26px 18px 40px;
      color: rgba(0,0,0,.55);
      font-size: 12px;
      letter-spacing: .08em;
      text-transform: uppercase;
    }
  </style>
</head>

<body>
  <header class="hero" aria-label="ruin2itive hero background"></header>

  <div class="wrap">
    <main>
      <section class="grid">
        <!-- LEFT -->
        <article class="card" aria-label="Projects / The Code">
          <div class="head">
            <div class="kicker">Projects / The Code</div>
          </div>
          <div class="body" id="projects-root">
            <div class="feature">
              <div class="headline">Loading…</div>
              <div class="sub">Pulling project links.</div>
              <div class="status">Status: loading</div>
            </div>
          </div>
        </article>

        <!-- RIGHT -->
        <article class="card" aria-label="Markets / Crypto">
          <div class="head">
            <div class="kicker">Markets / Crypto</div>
          </div>
          <div class="body" id="decrypt-root">
            <div class="feature">
              <div class="headline">Loading…</div>
              <div class="sub">Waiting on the feed.</div>
              <div class="status">Status: loading</div>
            </div>
          </div>

          <div class="head" style="border-top:1px solid var(--rule);">
            <div class="kicker">Hacker News</div>
          </div>
          <div class="body" id="hn-root">
            <div class="feature">
              <div class="headline">Quiet</div>
              <div class="sub">This section fills from <span class="stamp">home.json</span> when available.</div>
              <div class="status">Status: standby</div>
            </div>
          </div>
        </article>
      </section>
    </main>
  </div>

  <footer>
    ruin2itive.org — signals • systems • memory
  </footer>

  <script>
    // -----------------------------
    // Utilities
    // -----------------------------
    function esc(s){
      return String(s ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function nowBust(){
      // bust cache without going crazy
      const d = new Date();
      return String(d.getTime());
    }

    function stamp(text, variant){
      const cls = variant === "source" ? "stamp red" : "stamp";
      return `<span class="${cls}">${esc(text)}</span>`;
    }

    // repo-safe base path:
    // - custom domain: "/"
    // - github pages repo: "/ruin2itive-site/"
    function basePath(){
      const p = location.pathname;
      // if running at /ruin2itive-site/... use that as base
      const m = p.match(/^\/([^\/]+)\/?/);
      const repo = m && (m[1] || "");
      // If you're on a GitHub Pages repo site, keep the first segment as base.
      // If you're on your custom domain root, base is "/".
      if (location.hostname.endsWith("github.io") && repo){
        return "/" + repo;
      }
      return "";
    }

    function path(u){
      const b = basePath();
      // u must start with "/"
      return b + u;
    }

    async function fetchJson(url){
      const r = await fetch(url, { cache: "no-store" });
      if (!r.ok) throw new Error(`HTTP ${r.status}`);
      return await r.json();
    }

    function renderError(root, title, detail){
      root.innerHTML = `
        <div class="feature">
          <div class="headline">${esc(title)}</div>
          <div class="sub">${esc(detail)}</div>
          <div class="status">Status: error</div>
        </div>
      `;
    }

    // -----------------------------
    // Renderers
    // -----------------------------
    function renderProjects(data){
      const root = document.getElementById("projects-root");
      const groups = data?.groups;

      if (!Array.isArray(groups) || groups.length === 0){
        root.innerHTML = `
          <div class="feature">
            <div class="headline">No projects</div>
            <div class="sub">Your projects.json has no groups.</div>
            <div class="status">Status: empty</div>
          </div>
        `;
        return;
      }

      const html = groups.map(g => {
        const name = g?.name || "project";
        const links = Array.isArray(g?.links) ? g.links : [];

        const pills = links.map(l => {
          const label = l?.label || "link";
          const url = l?.url || "#";
          return `<a class="pill" href="${esc(url)}" target="_blank" rel="noopener">${esc(label)}</a>`;
        }).join("");

        return `
          <div class="proj">
            <div class="name">${esc(name)}</div>
            <div class="pills">${pills}</div>
          </div>
        `;
      }).join("");

      root.innerHTML = html;
    }

    function renderDecrypt(data){
      const root = document.getElementById("decrypt-root");
      const items = Array.isArray(data?.items) ? data.items : [];
      const updated = data?.updated ? new Date(data.updated) : null;

      // SEED/epoch detection (prevents "12/31/1969")
      const isSeed =
        (items[0]?.stamp === "SEED") ||
        (typeof data?.updated === "string" && data.updated.startsWith("1970-")) ||
        (!updated || isNaN(updated.getTime())) ||
        (updated && updated.getFullYear && updated.getFullYear() < 2000);

      const updatedText = (!isSeed)
        ? `Updated: ${updated.toLocaleString()}`
        : null;

      const itemsHtml = items.slice(0, 5).map(it => {
        const title = it?.title || "Untitled";
        const url = it?.url || "#";
        const src = it?.source || "decrypt";
        const st = it?.stamp || "";

        return `
          <a class="item" href="${esc(url)}" target="_blank" rel="noopener">
            <h3>${esc(title)}</h3>
            <div class="meta">
              ${st ? stamp(st) : ""}
              ${stamp(src, "source")}
            </div>
          </a>
        `;
      }).join("");

      root.innerHTML = `
        ${updatedText ? `<div class="meta" style="padding:2px 0 10px;">${stamp(updatedText)}</div>` : ""}
        ${itemsHtml || `
          <div class="feature">
            <div class="headline">No items</div>
            <div class="sub">Your feed is empty.</div>
            <div class="status">Status: empty</div>
          </div>
        `}
      `;
    }

    function renderHNfromHomeJson(home){
      const root = document.getElementById("hn-root");
      const items = home?.sections?.hacker;

      if (!Array.isArray(items) || items.length === 0){
        // keep default quiet card
        return;
      }

      const updated = home?.updated_iso ? new Date(home.updated_iso) : null;
      const updatedText = (updated && !isNaN(updated.getTime()))
        ? `Updated: ${updated.toLocaleString()}`
        : null;

      const html = items.slice(0, 5).map(it => {
        const title = it?.title || "Untitled";
        const url = it?.url || "#";
        return `
          <a class="item" href="${esc(url)}" target="_blank" rel="noopener">
            <h3>${esc(title)}</h3>
            <div class="meta">${stamp("hn", "source")}${stamp("newest")}</div>
          </a>
        `;
      }).join("");

      root.innerHTML = `
        ${updatedText ? `<div class="meta" style="padding:2px 0 10px;">${stamp(updatedText)}</div>` : ""}
        ${html}
      `;
    }

    // -----------------------------
    // Boot
    // -----------------------------
    async function boot(){
      // Projects
      try{
        const projects = await fetchJson(`${path("/data/projects.json")}?${nowBust()}`);
        renderProjects(projects);
      }catch(e){
        renderError(
          document.getElementById("projects-root"),
          "Projects",
          `Could not load ${path("/data/projects.json")} (${e.message}).`
        );
      }

      // Decrypt
      try{
        const decrypt = await fetchJson(`${path("/data/decrypt.json")}?${nowBust()}`);
        renderDecrypt(decrypt);
      }catch(e){
        renderError(
          document.getElementById("decrypt-root"),
          "Decrypt",
          `Could not load ${path("/data/decrypt.json")} (${e.message}).`
        );
      }

      // Optional home.json for HN
      try{
        const home = await fetchJson(`${path("/data/home.json")}?${nowBust()}`);
        renderHNfromHomeJson(home);
      }catch(_e){
        // silent: home.json is optional
      }
    }

    boot();
  </script>
</body>
</html>
